<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a">
    <link rel="manifest" href="manifest.json">
    <title>Fractured City - Roguelike</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-container">
        <div id="main-view">
            <canvas id="game-canvas"></canvas>
        </div>
        
        <div id="ui-panels">
            <div id="log-panel" class="panel">
                <h3>Log</h3>
                <div id="log-content"></div>
            </div>
            
            <div id="character-panel" class="panel">
                <h3>Character</h3>
                <div id="character-content"></div>
            </div>
            
            <div id="minimap-panel" class="panel">
                <h3>Map</h3>
                <canvas id="minimap-canvas"></canvas>
            </div>
            
            <div id="context-panel" class="panel">
                <h3>Target Info</h3>
                <div id="context-content"></div>
            </div>
            
            <div id="location-panel" class="panel">
                <h3>Location</h3>
                <div id="location-content"></div>
            </div>
        </div>
        
        <!-- Mobile Controls (hidden on desktop) -->
        <div id="mobile-controls">
            <div id="mobile-hud">
                <span id="mobile-hp"></span>
                <span id="mobile-status"></span>
                <span id="mobile-zone"></span>
            </div>
            
            <div id="mobile-bottom">
                <div id="mobile-dpad">
                    <button type="button" class="dpad-btn" id="dpad-up" data-dx="0" data-dy="-1">&#9650;</button>
                    <div class="dpad-mid-row">
                        <button type="button" class="dpad-btn" id="dpad-left" data-dx="-1" data-dy="0">&#9664;</button>
                        <button type="button" class="dpad-btn dpad-center" id="dpad-wait" data-action="wait">&#9679;</button>
                        <button type="button" class="dpad-btn" id="dpad-right" data-dx="1" data-dy="0">&#9654;</button>
                    </div>
                    <button type="button" class="dpad-btn" id="dpad-down" data-dx="0" data-dy="1">&#9660;</button>
                </div>
                
                <div id="mobile-actions">
                    <div class="action-row">
                        <button type="button" class="action-btn" id="btn-interact" data-action="interact">ACT</button>
                        <button type="button" class="action-btn" id="btn-inspect" data-action="inspect">LOOK</button>
                        <button type="button" class="action-btn" id="btn-inventory" data-action="inventory">INV</button>
                        <button type="button" class="action-btn" id="btn-craft" data-action="craft">CRAFT</button>
                        <button type="button" class="action-btn" id="btn-character" data-action="character">CHAR</button>
                    </div>
                    <div class="action-row">
                        <button type="button" class="action-btn" id="btn-grab" data-action="grab_all">GRAB</button>
                        <button type="button" class="action-btn" id="btn-abilities" data-action="abilities">ABIL</button>
                        <button type="button" class="action-btn" id="btn-move-mode" data-action="move_mode">MODE</button>
                        <button type="button" class="action-btn" id="btn-stance" data-action="combat_stance">STNC</button>
                        <button type="button" class="action-btn" id="btn-combat" data-action="combat_detail">BTL</button>
                        <button type="button" class="action-btn" id="btn-ascend" data-action="ascend">&#9650;Z</button>
                        <button type="button" class="action-btn" id="btn-descend" data-action="descend">&#9660;Z</button>
                    </div>
                </div>
            </div>
            
            <div id="mobile-panel-tabs">
                <button class="panel-tab active" data-panel="log-panel">LOG</button>
                <button class="panel-tab" data-panel="character-panel">CHAR</button>
                <button class="panel-tab" data-panel="minimap-panel">MAP</button>
                <button class="panel-tab" data-panel="context-panel">INFO</button>
                <button class="panel-tab" data-panel="location-panel">LOC</button>
            </div>
            
            <div id="mobile-panel-drawer" class="hidden">
                <div id="mobile-panel-content"></div>
            </div>
        </div>
    </div>
    
    <!-- Combat Detail Overlay (non-blocking, sits on top of game canvas) -->
    <div id="combat-overlay" class="hidden">
        <div id="combat-overlay-header">
            <span id="combat-overlay-title">COMBAT</span>
            <button id="close-combat-btn" class="small-btn">Close [B]</button>
        </div>
        <div id="combat-overlay-body">
            <div id="combat-player-panel" class="combat-entity-panel"></div>
            <div id="combat-feed-panel"></div>
            <div id="combat-enemy-panel" class="combat-entity-panel"></div>
        </div>
    </div>
    
    <div id="character-creation" class="modal hidden">
        <div class="modal-content">
            <h2>Character Creation</h2>
            <div id="creation-form"></div>
        </div>
    </div>
    
    <div id="detailed-character" class="modal hidden">
        <div class="modal-content">
            <h2>Character Sheet</h2>
            <div id="detailed-character-content"></div>
            <button id="close-character-btn">Close [C]</button>
        </div>
    </div>
    
    <div id="detailed-inventory" class="modal hidden">
        <div class="modal-content">
            <h2>Interact</h2>
            <div id="detailed-inventory-content"></div>
            <button id="close-inventory-btn">Close [I]</button>
        </div>
    </div>
    
    <div id="ability-popup" class="hidden"></div>
    
    <div id="ability-panel" class="modal hidden">
        <div class="modal-content">
            <h2>Combat Abilities [Q]</h2>
            <div id="ability-panel-content"></div>
            <button id="close-ability-btn">Close [Q]</button>
        </div>
    </div>
    
    <div id="help-screen" class="modal hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div id="help-tabs" style="display: flex; gap: 4px; margin-bottom: 12px; border-bottom: 2px solid #333; padding-bottom: 8px;"></div>
            <div id="help-search" style="display: none; margin-bottom: 10px;">
                <input id="help-search-input" type="text" placeholder="Search..." style="width: 100%; padding: 6px 10px; background: #1a1a1a; border: 1px solid #444; color: #fff; font-size: 13px; border-radius: 3px;">
            </div>
            <div id="help-content" style="max-height: 65vh; overflow-y: auto;"></div>
            <button id="close-help-btn">Close [?]</button>
        </div>
    </div>
    
    <script type="module" src="src/main.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
        }
    </script>
</body>
</html>
